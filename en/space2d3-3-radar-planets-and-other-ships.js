(()=>{var g=class{static id;get mytype(){return this.constructor}get typename(){return this.mytype.id}toJSON(){return{type:this.typename}}static fromJSON(e,t){return new e}};function H(r){let e=_[r.type];return e.fromJSON(e,r)}var _={};function m(r,e){_[e]=r,r.id=e}var w=class extends g{},N=class extends w{},F=class extends N{};m(F,"Rocket");var $=class extends N{};m($,"Fuel");var b=class extends w{},x=class extends b{static color="blue"};m(x,"Water");var S=class extends b{static color="yellow"};m(S,"Iron");var O=class extends b{static color="green"};m(O,"Food");var L=class extends b{static color="red"};m(L,"Radioactives");var oe=["black","darkslategray","darkolivegreen","saddlebrown","darkred","olive","darkslateblue","cadetblue","green","mediumseagreen","steelblue","chocolate","yellowgreen","indianred","darkblue","limegreen","goldenrod","darkseagreen","purple","maroon3","red","darkturquoise","darkorange","gold","yellow","mediumblue","burlywood","lime","mediumspringgreen","blueviolet","crimson","deepskyblue","greenyellow","tomato","orchid","lightsteelblue","fuchsia","khaki","cornflower","plum","deeppink","mediumslateblue","lightsalmon","paleturquoise","palegreen","aquamarine","lightgoldenrod","hotpink","lightpink","lavenderblush"];var a=50,p=5;function ue(r,e,t,o,n,i){o.isAlien?r.rect(e*a,t*a+p,a,a-2*p):r.rect(e*a+p,t*a,a-2*p,a),r.strokeStyle="white",r.fillStyle="white",r.stroke(),r.textBaseline="top",r.fillText(n.cellName||"",e*a+p,t*a),r.fillText(n.typename[0],e*a+p,t*a+16),i&&(i.map[e][t].canBeHere=!0,i.map[e][t].canGoX=o.isAlien,i.map[e][t].canGoY=!o.isAlien,i.map[e][t].ship=o,i.map[e][t].component=n)}function ce(r,e,t,o,n){let i=o.passage;if(r.rect((e+i.x)*a,(t+i.y)*a,i.w*a,i.h*a),r.strokeStyle="white",r.fillStyle="white",r.stroke(),r.textBaseline="top",n){let s=new R;for(let h=0;h<i.w;h++)for(let l=0;l<i.h;l++)n.map[h+e][l+t].canBeHere=!0,n.map[h+e][l+t].canGoX=!0,n.map[h+e][l+t].canGoY=!0,n.map[h+e][l+t].ship=o,n.map[h+e][l+t].component=s}}function ne(r,e,t,o){r.strokeStyle="white",r.strokeStyle="white",r.fillStyle="white",r.beginPath(),r.moveTo(e*a+p,t*a),r.lineTo(e*a+p*2,(t+.5)*a),r.lineTo(e*a+p,(t+1)*a),r.lineTo((e+1)*a-p,(t+1)*a),r.lineTo((e+1)*a-p*2,(t+.5)*a),r.lineTo((e+1)*a-p,t*a),r.closePath(),r.stroke(),o&&(o.map[e][t].canBeHere=!0,o.map[e][t].canGoY=!0,o.map[e][t].component=new A)}function q(r,e,t,o,n){for(let i=0;i<o.rows.length;i++)for(let s=0;s<o.rows[i].length;s++){let h=o.rows[i][s],l=o.rowToXY(i,s);h.cellName=String.fromCharCode(65+i)+l.y,ue(r,e+l.x,t-l.y,o,h,n)}ce(r,e,t,o,n)}function fe(r,e,t,o,n){e.updateSpaceXY(n);let i=e.spaceX*t,s=e.spaceY*t;r.fillStyle=e.color,r.fillRect(i,s,2,2)}function de(r,e,t){let o=e.x*t,n=e.y*t;var i=r.createRadialGradient(o-1,n-1,2,o,n,.2*t);i.addColorStop(0,e.color_in),i.addColorStop(1,e.color_out),r.fillStyle=i,r.beginPath(),r.arc(o,n,.2*t,0,7),r.fill()}function ie(r,e,t){let o=r.canvas.width,n=o/e.size,i=o/2;if(r.clearRect(0,0,o,o),e.bright){let s=r.createRadialGradient(i,i,0,i,i,n/2);s.addColorStop(0,"white"),s.addColorStop(.5,e.color),s.addColorStop(1,"transparent"),r.fillStyle=s,r.fillRect(0,0,o,o)}else{let s=r.createRadialGradient(i,i,10,i,i,n/2);s.addColorStop(0,e.color),s.addColorStop(1,"transparent"),r.fillStyle=s,r.fillRect(0,0,o,o)}for(let s of e.planets)de(r,s,n);if(t!==void 0)for(let s of e.ships)fe(r,s,n,0,t)}var J=class extends g{cellName="";onEnter(e){}},v=class extends J{},A=class extends v{};m(A,"Airlock");var R=class extends v{};m(R,"Passage");var u=class extends v{opposite="";onEnter(e){document.querySelector("#Ballast b").innerText=this.opposite||""}};m(u,"Ballast");var V=class r extends v{original="";toJSON(){return{type:this.typename,original:this.original}}static fromJSON(e,t){let o=new r;return o.original=t.original,o}};m(V,"Debris");var k=class extends J{},G=class r extends k{cargo=[];toJSON(){return{type:this.typename,cargo:this.cargo.map(e=>e.toJSON())}}static fromJSON(e,t){let o=new r;return o.cargo=t.cargo.map(n=>H(n)),o}onEnter(e){document.querySelector("#CargoBay ul").innerHTML=this.cargo.map(t=>`<li>${t.typename}</li>`).join(""),document.getElementById("CargoBay_Empty").style.display=this.cargo.length==0?"":"none",document.getElementById("CargoBay_NonEmpty").style.display=this.cargo.length==0?"none":""}};m(G,"CargoBay");var K=class extends k{onEnter(e){let o=document.querySelector("#Radar canvas").getContext("2d");e.realTimestamp=performance.now(),window.requestAnimationFrame(se)}};m(K,"Radar");function se(r){let e=document.querySelector("#Radar canvas");if(e.offsetParent===null)return;let t=e.getContext("2d"),o=window.gs;o.now+=Math.max(0,Math.min(r-o.realTimestamp,1e3))/1e3,o.realTimestamp=r,ie(t,o.star,o.now),window.requestAnimationFrame(se)}function C(r,e){return r>e&&([r,e]=[e,r]),Math.floor(Math.random()*(e-r+1))+r}function T(r){return r[Math.floor(Math.random()*r.length)]}function M(r){return r.map(e=>({sort:Math.random(),value:e})).sort((e,t)=>e.sort-t.sort).map(e=>e.value)}function D(r){return[...Array(r).keys()]}var d=class r{color;isAlien=!1;rows=[];offsets=[];isPlayerShip=!1;playerOnShip=!1;playerX;playerY;spaceX;spaceY;fromPlanet;toPlanet;fromTime;toTime;updateSpaceXY(e){for(;e>=this.toTime;)this.toPlanet.dispatch(this,this.toTime);let t=(e-this.fromTime)/(this.toTime-this.fromTime);this.spaceX=this.fromPlanet.x+(this.toPlanet.x-this.fromPlanet.x)*t,this.spaceY=this.fromPlanet.y+(this.toPlanet.y-this.fromPlanet.y)*t}toJSON(){return{isAlien:this.isAlien,offsets:this.offsets,rows:this.rows.map(e=>e.map(t=>t.toJSON()))}}static fromJSON(e){let t=new r;return t.isAlien=e.isAlien,t.offsets=e.offsets,t.rows=e.rows.map(o=>o.map(n=>H(n))),t}get gridSize(){if(this.isAlien)return{x0:0,x1:0,y0:0,y1:0,w:0,h:0};{let e=0,t=0;for(let o=0;o<this.rows.length;o++)e=Math.max(e,this.rows[o].length-this.offsets[o]),t=Math.max(t,this.offsets[o]);return{x0:0,x1:this.rows.length-1,y0:e,y1:t,w:this.rows.length,h:e+t+1}}}rowToXY(e,t){return this.isAlien?{x:0,y:0}:t>=this.offsets[e]?{x:e,y:1+(t-this.offsets[e])}:{x:e,y:t-this.offsets[e]}}get passage(){return this.isAlien?{x:0,y:0,w:0,h:0}:{x:0,y:0,w:this.rows.length,h:1}}oppositeComponent(e){for(let t=0;t<=this.rows.length;t++){let o=this.rows[t].indexOf(e);if(o>=0)return this.rows[this.rows.length-1-t][o]}}static randomShip(e){let o=Object.values(_).filter(s=>s.prototype instanceof k),n=Object.values(_).filter(s=>s.prototype instanceof w),i=new r;i.color=T(oe),i.rows=[[],[],[],[]],i.offsets=[0,0,0,0];for(let s=0;s<e;s++){let h=C(0,3),l=T(o),P=new l;if(P instanceof G){let X=C(0,4);for(let re=0;re<X;re++){let pe=T(n);P.cargo.push(new pe)}}i.rows[h].push(P)}for(let s=0;s<i.rows.length;s++)i.offsets[s]=C(0,i.rows[s].length);return i.balanceBallast(),i}balanceBallast(){if(!this.isAlien){let o=this.rows.length-1;for(var e=0;e<=o;e++)for(;this.offsets[e]<this.offsets[o-e];)this.rows[e].unshift(new u),this.offsets[e]++;for(var e=0;e<=o;e++)for(;this.rows[e].length<this.rows[o-e].length;)this.rows[e].push(new u);for(var e=0;e<=o;e++)for(;this.rows[e][0]instanceof u&&this.rows[o-e][0]instanceof u;)this.rows[e].shift(),this.rows[o-e].shift(),this.offsets[e]--,this.offsets[o-e]++;for(var e=0;e<=o;e++)for(;this.rows[e].at(-1)instanceof u&&this.rows[o-e].at(-1)instanceof u;)this.rows[e].pop(),this.rows[o-e].pop();for(var e=0;e<=o;e++)for(var t=0;t<=this.rows[e].length;t++)this.rows[e][t]instanceof u&&(this.rows[e][t].opposite=this.rows[o-e][t].typename)}}get topAirlock(){if(this.isAlien)return 0;{let e=0;for(let t=0;t<this.rows.length;t++)e=Math.max(e,this.rows[t].length-this.offsets[t]);for(let t=0;t<this.rows.length;t++)if(this.rows[t].length-this.offsets[t]==e)return t;return 0}}get bottomAirlock(){if(this.isAlien)return 0;{let e=Math.max(...this.offsets);return this.offsets.lastIndexOf(e)}}};var U=class{canBeHere=!1;canGoX=!1;canGoY=!1;ship;component},E=class{map=[];constructor(e,t){for(let o=0;o<=e;o++){this.map[o]=[];for(let n=0;n<=t;n++)this.map[o][n]=new U}}},W=class{x;y;map;box;human;canvas;onEnter;goX(e){return!this.map.map[this.x][this.y].canGoX||!this.map.map[this.x+e][this.y].canBeHere?!1:(this.x+=e,this.reposition(),this.onEnter(this.map.map[this.x][this.y].component),!0)}goY(e,t){return!t&&!this.map.map[this.x][this.y].canGoY||!this.map.map[this.x][this.y+e].canBeHere?!1:(this.y+=e,this.reposition(),this.onEnter(this.map.map[this.x][this.y].component),!0)}goUp(){this.goY(-1),this.human.style.transform="rotate(0deg)"}goDn(e){this.goY(1,e),this.human.style.transform="rotate(180deg)"}goLt(){this.goX(-1),this.human.style.transform="rotate(-90deg)"}goRt(){this.goX(1),this.human.style.transform="rotate(90deg)"}jumpTo(e,t,o,n){o!==void 0&&n!==void 0||(this.x=e,this.y=t,this.reposition(!0),this.onEnter(this.map.map[e][t].component))}reposition(e){e&&this.canvas.classList.add("notransition");let t=(this.x+.5)*a,n=this.box.offsetWidth/2-t;this.canvas.style.left=n+"px";let i=(this.y+.5)*a,h=this.box.offsetHeight/2-i;this.canvas.style.top=h+"px",e&&(this.canvas.offsetHeight,this.canvas.classList.remove("notransition"))}};var j=class{walker;oneShipData;twoShipsData;myShip;putTwoShips(e,t){let o=e.gridSize,n=t.gridSize,i=e.bottomAirlock,s=t.topAirlock,h=Math.max(i,s)+1,l=o.h+1,P=h+Math.max(o.w-i,n.w-s),X=l+n.h+1;this.twoShipsData={ax0:h-i+o.x0,ay0:o.y0+1,airlock_x:h,airlock_y:l,bx0:h-s+n.x0,by0:l+n.y0+1,max_x:P,max_y:X}}drawTwoShips(e,t,o){this.putTwoShips(t,o);let n=this.twoShipsData,i=new E(n.max_x,n.max_y);this.walker.map=i,e.canvas.width=a*(n.max_x+1),e.canvas.height=a*(n.max_y+1),q(e,n.ax0,n.ay0,t,i),q(e,n.bx0,n.by0,o,i),ne(e,n.airlock_x,n.airlock_y,i)}drawMyShip(e){let t=this.oneShipData=this.myShip.gridSize,o=this.walker.map=new E(t.w+1,t.h+1);e.canvas.width=a*(t.w+2),e.canvas.height=a*(t.h+2),q(e,t.x0+1,t.y0+1,this.myShip,o)}detach(e){let t=this.walker.x-this.twoShipsData.bx0,o=this.walker.y-this.twoShipsData.by0+1;this.drawMyShip(e),this.walker.jumpTo(this.oneShipData.x0+1+t,this.oneShipData.y0+o),this.walker.goDn(!0)}attach(e,t){let o=this.walker.x-1-this.oneShipData.x0,n=this.walker.y-1-this.oneShipData.y0;this.drawTwoShips(e,t,this.myShip),this.walker.jumpTo(this.twoShipsData.bx0+o,this.twoShipsData.by0+n)}};function ye(r,e){let t=Math.hypot(r,e);return[r/t,e/t]}function ge(r,e){return r[0]*e[0]+r[1]*e[1]}function we(r,e,t){let o=ye(r.x-e.x,r.y-e.y),n=ge(o,[t.x-e.x,t.y-e.y]);return[e.x+o[0]*n,e.y+o[1]*n]}function Z(r,e,t,o){let[n,i]=we(r,e,t);return n>=Math.min(r.x,e.x)&&n<=Math.max(r.x,e.x)&&i>=Math.min(r.y,e.y)&&i<=Math.max(r.y,e.y)&&Math.hypot(n-t.x,i-t.y)<o}var ae=function(){let r=[x,S,O,L];for(var e=[[null,"water-mining","farming","burning"],["ice",null,"hunting","fire"],["fishy","bio-mining",null,"nuclear"],["frozen","hot mining","ice-farming",null]],t=[["ocean",null,x,"navy","blue"],["mining",null,S,"olive","yellow"]],o=0;o<4;o++)for(var n=0;n<4;n++)o!=n&&t.push([e[o][n],r[o],r[n],r[o].color,r[n].color]);return t}(),z=class{x;y;type;name;buys;sells;color_in;color_out;neighbours;constructor(e,t,o){var n=ae[o];this.x=e,this.y=t,this.type=o,this.name=n[0],this.buys=n[1],this.sells=n[2],this.color_in=n[3],this.color_out=n[4]}save(){return[this.x,this.y,this.type]}dispatch(e,t){let o=this.neighbours.shift();this.neighbours.push(o),e.fromPlanet=this,e.toPlanet=o,e.fromTime=t;let i=Math.hypot(this.x-o.x,this.y-o.y)/.1;e.toTime=t+i}};function be(r,e,t){var o=t/2;return r<o+.6&&r>o-.6&&e<o+.6&&e>o-.6}function le(r){for(var e=M(D(ae.length)),t=0;t<100;t++){for(var o=!1,n=[],i=M(D(r)),s=M(D(r)),h=r/2,l=0;l<r;l++)be(i[l]+.5,s[l]+.5,r)&&(o=!0),n.push([i[l]+.5,s[l]+.5,e[l]]);if(!o)return n}return console.error("should not be here"),[]}var xe=["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","BlanchedAlmond","Blue","BlueViolet","Brown","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkGray","DarkGrey","DarkKhaki","DarkOrange","DarkOrchid","DarkSalmon","DarkSeaGreen","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DodgerBlue","FireBrick","FloralWhite","Fuchsia","Gainsboro","GhostWhite","Gold","Goldenrod","Gray","GreenYellow","Grey","Honeydew","HotPink","IndianRed","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenrodYellow","LightGray","LightGreen","LightGrey","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSlateGrey","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","MediumAquamarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MintCream","MistyRose","Moccasin","NavajoWhite","OldLace","Orange","OrangeRed","Orchid","PaleGoldenrod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Red","RosyBrown","RoyalBlue","Salmon","SandyBrown","Seashell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","SlateGrey","Snow","SpringGreen","SteelBlue","Tan","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"];function Se(r,e){for(var t=D(e).map(s=>[]),o=(e-1)/2,n=Math.floor(o);n<=Math.ceil(o);n++)for(var i=Math.floor(o);i<=Math.ceil(o);i++)t[n+1][i+1]=r;return t}var I=class{color;size;visited;x;y;bright;name;grid;planets;ships;jobs;constructor(e){e||(e={c:T(xe),s:C(5,9),p:!1,v:!1}),this.color=e.c,this.size=e.s,this.visited=e.v,this.x=this.y=this.size/2,this.bright=!1,this.name=this.color,this.size%2==0&&(this.bright=!0,this.name="bright "+this.name),this.grid=Se(this,this.size),e.p||(e.p=le(this.size)),this.planets=e.p.map(o=>new z(...o));for(var t of this.planets)t.neighbours=M(this.planets.filter(o=>o!=t&&!this.pathCollides(o,t))),this.grid[Math.floor(t.x)][Math.floor(t.y)]=t}pathCollides(e,t){if(Z(e,t,this,.5))return!0;for(var o of this.planets)if(o!=e&&o!=t&&Z(e,t,o,.2))return!0;return!1}addRandomShips(e){this.ships=[];for(let t=0;t<this.planets.length;t++)for(let o=0;o<t;o++){if(this.planets[t].neighbours.indexOf(this.planets[o])<0)continue;let n=d.randomShip(15),s=Math.hypot(this.planets[t].x-this.planets[o].x,this.planets[t].y-this.planets[o].y)/.1;this.planets[t].dispatch(n,e-s),this.ships.push(n)}}save(){return{c:this.color,s:this.size,p:this.planets.map(e=>e.save()),v:this.visited}}};function c(r){let e=document.getElementById(r);if(!e)throw ReferenceError(`element ${r} not found`);return e}function gt(r){let e=c(r);if(!(e instanceof HTMLInputElement))throw ReferenceError(`element ${r} is not input`);return e}(location.hostname=="localhost"||location.hostname=="127.0.0.1")&&new EventSource("/esbuild").addEventListener("change",()=>location.reload());var ve=d.randomShip(15),wt=d.randomShip(35),ee={star:new I,now:0};window.gs=ee;ee.star.addRandomShips(0);var f=new W,y=new j;y.walker=f;var he=c("myCanvas"),te=he.getContext("2d");f.box=c("canvasBox");f.human=c("human");f.canvas=he;f.onEnter=Ce;function ke(){y.myShip=ve,y.drawMyShip(te),f.jumpTo(y.oneShipData.x0+1,y.oneShipData.y0+1),me()}function me(){y.attach(te,d.randomShip(25)),B("Docked to another ship")}ke();window.onkeypress=r=>{switch(r.key){case"w":f.goUp();break;case"a":f.goLt();break;case"s":f.goDn();break;case"d":f.goRt();break}};function Ce(r){r&&(c("currentComponent").innerHTML=`#${r.typename} {display:block}`,r.cellName?c("componentLegend").innerText=`${r.cellName}: ${r.typename}`:c("componentLegend").innerText=`${r.typename}`,r.onEnter(ee))}function B(r){c("status").innerText=r}c("Airlock_Detach").onclick=()=>{y.detach(te),B("Docking to next ship in 5..."),setTimeout(()=>B("Docking to next ship in 4..."),1e3),setTimeout(()=>B("Docking to next ship in 3..."),2e3),setTimeout(()=>B("Docking to next ship in 2..."),3e3),setTimeout(()=>B("Docking to next ship in 1..."),4e3),setTimeout(()=>me(),5e3)};})();
//# sourceMappingURL=space2d3-3-radar-planets-and-other-ships.js.map
