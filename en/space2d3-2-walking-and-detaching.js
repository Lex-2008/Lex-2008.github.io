(()=>{var y=class{static id;get mytype(){return this.constructor}get typename(){return this.mytype.id}toJSON(){return{type:this.typename}}static fromJSON(t,e){return new t}};function O(n){let t=k[n.type];return t.fromJSON(t,n)}var k={};function f(n,t){k[t]=n,n.id=t}var L=class extends y{},g=class extends L{},J=class extends g{};f(J,"Rocket");var j=class extends g{};f(j,"Fuel");var M=class extends y{cellName="";onEnter(t){}},x=class extends M{},v=class extends x{};f(v,"Airlock");var T=class extends x{};f(T,"Passage");var m=class extends x{opposite="";onEnter(t){t.getElementsByTagName("b")[0].innerText=this.opposite||""}};f(m,"Ballast");var R=class n extends x{original="";toJSON(){return{type:this.typename,original:this.original}}static fromJSON(t,e){let o=new n;return o.original=e.original,o}};f(R,"Debris");var C=class extends M{},D=class n extends C{cargo=[];toJSON(){return{type:this.typename,cargo:this.cargo.map(t=>t.toJSON())}}static fromJSON(t,e){let o=new n;return o.cargo=e.cargo.map(s=>O(s)),o}onEnter(t){t.getElementsByTagName("ul")[0].innerHTML=this.cargo.map(e=>`<li>${e.typename}</li>`).join(""),t.getElementsByClassName("CargoBay_Empty")[0].style.display=this.cargo.length==0?"":"none",t.getElementsByClassName("CargoBay_NonEmpty")[0].style.display=this.cargo.length==0?"none":""}};f(D,"CargoBay");function A(n,t){return n>t&&([n,t]=[t,n]),Math.floor(Math.random()*(t-n+1))+n}function z(n){return n[Math.floor(Math.random()*n.length)]}var b=class n{isAlien=!1;rows=[];offsets=[];toJSON(){return{isAlien:this.isAlien,offsets:this.offsets,rows:this.rows.map(t=>t.map(e=>e.toJSON()))}}static fromJSON(t){let e=new n;return e.isAlien=t.isAlien,e.offsets=t.offsets,e.rows=t.rows.map(o=>o.map(s=>O(s))),e}get gridSize(){if(this.isAlien)return{x0:0,x1:0,y0:0,y1:0,w:0,h:0};{let t=0,e=0;for(let o=0;o<this.rows.length;o++)t=Math.max(t,this.rows[o].length-this.offsets[o]),e=Math.max(e,this.offsets[o]);return{x0:0,x1:this.rows.length-1,y0:t,y1:e,w:this.rows.length,h:t+e+1}}}rowToXY(t,e){return this.isAlien?{x:0,y:0}:e>=this.offsets[t]?{x:t,y:1+(e-this.offsets[t])}:{x:t,y:e-this.offsets[t]}}get passage(){return this.isAlien?{x:0,y:0,w:0,h:0}:{x:0,y:0,w:this.rows.length,h:1}}oppositeComponent(t){for(let e=0;e<=this.rows.length;e++){let o=this.rows[e].indexOf(t);if(o>=0)return this.rows[this.rows.length-1-e][o]}}static randomShip(t){let o=Object.values(k).filter(a=>a.prototype instanceof C),s=Object.values(k).filter(a=>a.prototype instanceof g),r=new n;r.rows=[[],[],[],[]],r.offsets=[0,0,0,0];for(let a=0;a<t;a++){let h=A(0,3),l=z(o),d=new l;if(d instanceof D){let H=A(0,4);for(let G=0;G<H;G++){let P=z(s);d.cargo.push(new P)}}r.rows[h].push(d)}for(let a=0;a<r.rows.length;a++)r.offsets[a]=A(0,r.rows[a].length);return r.balanceBallast(),r}balanceBallast(){if(!this.isAlien){let o=this.rows.length-1;for(var t=0;t<=o;t++)for(;this.offsets[t]<this.offsets[o-t];)this.rows[t].unshift(new m),this.offsets[t]++;for(var t=0;t<=o;t++)for(;this.rows[t].length<this.rows[o-t].length;)this.rows[t].push(new m);for(var t=0;t<=o;t++)for(;this.rows[t][0]instanceof m&&this.rows[o-t][0]instanceof m;)this.rows[t].shift(),this.rows[o-t].shift(),this.offsets[t]--,this.offsets[o-t]++;for(var t=0;t<=o;t++)for(;this.rows[t].at(-1)instanceof m&&this.rows[o-t].at(-1)instanceof m;)this.rows[t].pop(),this.rows[o-t].pop();for(var t=0;t<=o;t++)for(var e=0;e<=this.rows[t].length;e++)this.rows[t][e]instanceof m&&(this.rows[t][e].opposite=this.rows[o-t][e].typename)}}get topAirlock(){if(this.isAlien)return 0;{let t=0;for(let e=0;e<this.rows.length;e++)t=Math.max(t,this.rows[e].length-this.offsets[e]);for(let e=0;e<this.rows.length;e++)if(this.rows[e].length-this.offsets[e]==t)return e;return 0}}get bottomAirlock(){if(this.isAlien)return 0;{let t=Math.max(...this.offsets);return this.offsets.lastIndexOf(t)}}};var i=50,p=5;function F(n,t,e,o,s,r){o.isAlien?n.rect(t*i,e*i+p,i,i-2*p):n.rect(t*i+p,e*i,i-2*p,i),n.strokeStyle="white",n.fillStyle="white",n.stroke(),n.textBaseline="top",n.fillText(s.cellName||"",t*i+p,e*i),n.fillText(s.typename[0],t*i+p,e*i+16),r&&(r.map[t][e].canBeHere=!0,r.map[t][e].canGoX=o.isAlien,r.map[t][e].canGoY=!o.isAlien,r.map[t][e].ship=o,r.map[t][e].component=s)}function q(n,t,e,o,s){let r=o.passage;if(n.rect((t+r.x)*i,(e+r.y)*i,r.w*i,r.h*i),n.strokeStyle="white",n.fillStyle="white",n.stroke(),n.textBaseline="top",s){let a=new T;for(let h=0;h<r.w;h++)for(let l=0;l<r.h;l++)s.map[h+t][l+e].canBeHere=!0,s.map[h+t][l+e].canGoX=!0,s.map[h+t][l+e].canGoY=!0,s.map[h+t][l+e].ship=o,s.map[h+t][l+e].component=a}}function X(n,t,e,o){n.strokeStyle="white",n.strokeStyle="white",n.fillStyle="white",n.beginPath(),n.moveTo(t*i+p,e*i),n.lineTo(t*i+p*2,(e+.5)*i),n.lineTo(t*i+p,(e+1)*i),n.lineTo((t+1)*i-p,(e+1)*i),n.lineTo((t+1)*i-p*2,(e+.5)*i),n.lineTo((t+1)*i-p,e*i),n.closePath(),n.stroke(),o&&(o.map[t][e].canBeHere=!0,o.map[t][e].canGoY=!0,o.map[t][e].component=new v)}function E(n,t,e,o,s){for(let r=0;r<o.rows.length;r++)for(let a=0;a<o.rows[r].length;a++){let h=o.rows[r][a],l=o.rowToXY(r,a);h.cellName=String.fromCharCode(65+r)+l.y,F(n,t+l.x,e-l.y,o,h,s)}q(n,t,e,o,s)}var W=class{canBeHere=!1;canGoX=!1;canGoY=!1;ship;component},_=class{map=[];constructor(t,e){for(let o=0;o<=t;o++){this.map[o]=[];for(let s=0;s<=e;s++)this.map[o][s]=new W}}},N=class{x;y;map;box;canvas;onEnter;goX(t){return!this.map.map[this.x][this.y].canGoX||!this.map.map[this.x+t][this.y].canBeHere?!1:(this.x+=t,this.reposition(),this.onEnter(this.map.map[this.x][this.y].component),!0)}goY(t){return!this.map.map[this.x][this.y].canGoY||!this.map.map[this.x][this.y+t].canBeHere?!1:(this.y+=t,this.reposition(),this.onEnter(this.map.map[this.x][this.y].component),!0)}goUp(){return this.goY(-1)}goDn(){return this.goY(1)}goLt(){return this.goX(-1)}goRt(){return this.goX(1)}jumpTo(t,e,o,s){o!==void 0&&s!==void 0?(this.x=o,this.y=s,this.reposition(!0),this.x=t,this.y=e,this.reposition(),this.onEnter(this.map.map[t][e].component)):(this.x=t,this.y=e,this.reposition(!0),this.onEnter(this.map.map[t][e].component))}reposition(t){t&&this.canvas.classList.add("notransition");let e=(this.x+.5)*i,s=this.box.offsetWidth/2-e;this.canvas.style.left=s+"px";let r=(this.y+.5)*i,h=this.box.offsetHeight/2-r;this.canvas.style.top=h+"px",t&&(this.canvas.offsetHeight,this.canvas.classList.remove("notransition"))}};var B=class{walker;oneShipData;twoShipsData;myShip;putTwoShips(t,e){let o=t.gridSize,s=e.gridSize,r=t.bottomAirlock,a=e.topAirlock,h=Math.max(r,a)+1,l=o.h+1,d=h+Math.max(o.w-r,s.w-a),H=l+s.h+1;this.twoShipsData={ax0:h-r+o.x0,ay0:o.y0+1,airlock_x:h,airlock_y:l,bx0:h-a+s.x0,by0:l+s.y0+1,max_x:d,max_y:H}}drawTwoShips(t,e,o){this.putTwoShips(e,o);let s=this.twoShipsData,r=new _(s.max_x,s.max_y);this.walker.map=r,t.canvas.width=i*(s.max_x+1),t.canvas.height=i*(s.max_y+1),E(t,s.ax0,s.ay0,e,r),E(t,s.bx0,s.by0,o,r),X(t,s.airlock_x,s.airlock_y,r)}drawMyShip(t){let e=this.oneShipData=this.myShip.gridSize,o=this.walker.map=new _(e.w+1,e.h+1);t.canvas.width=i*(e.w+2),t.canvas.height=i*(e.h+2),E(t,e.x0+1,e.y0+1,this.myShip,o)}detach(t){let e=this.walker.x-this.twoShipsData.bx0,o=this.walker.y-this.twoShipsData.by0+1;this.drawMyShip(t),this.walker.jumpTo(this.oneShipData.x0+1+e,this.oneShipData.y0+1+o,this.oneShipData.x0+1+e,this.oneShipData.y0+o)}attach(t,e){let o=this.walker.x-1-this.oneShipData.x0,s=this.walker.y-1-this.oneShipData.y0;this.drawTwoShips(t,e,this.myShip),this.walker.jumpTo(this.twoShipsData.bx0+o,this.twoShipsData.by0+s)}};function c(n){let t=document.getElementById(n);if(!t)throw ReferenceError(`element ${n} not found`);return t}function Tt(n){let t=c(n);if(!(t instanceof HTMLInputElement))throw ReferenceError(`element ${n} is not input`);return t}(location.hostname=="localhost"||location.hostname=="127.0.0.1")&&new EventSource("/esbuild").addEventListener("change",()=>location.reload());var U=b.randomShip(15),Ct=b.randomShip(35),u=new N;u.box=c("canvasBox");var w=new B;w.walker=u;var $=c("myCanvas"),Y=$.getContext("2d");u.canvas=$;u.onEnter=Q;function K(){w.myShip=U,w.drawMyShip(Y),u.jumpTo(w.oneShipData.x0+1,w.oneShipData.y0+1),I()}function I(){w.attach(Y,b.randomShip(25)),S("Docked to another ship")}K();window.onkeypress=n=>{switch(n.key){case"w":u.goUp();break;case"a":u.goLt();break;case"s":u.goDn();break;case"d":u.goRt();break}};function Q(n){if(!n)return;c("currentComponent").innerHTML=`#${n.typename} {display:block}`;let t=c(n.typename);n.cellName?c("componentLegend").innerText=`${n.cellName}: ${n.typename}`:c("componentLegend").innerText=`${n.typename}`,n.onEnter(t)}function S(n){c("status").innerText=n}c("Airlock_Detach").onclick=()=>{w.detach(Y),S("Docking to next ship in 5..."),setTimeout(()=>S("Docking to next ship in 4..."),1e3),setTimeout(()=>S("Docking to next ship in 3..."),2e3),setTimeout(()=>S("Docking to next ship in 2..."),3e3),setTimeout(()=>S("Docking to next ship in 1..."),4e3),setTimeout(()=>I(),5e3)};})();
//# sourceMappingURL=space2d3-2-walking-and-detaching.js.map
